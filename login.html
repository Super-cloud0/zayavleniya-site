<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход | НИШ Актобе</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="css/style.css?v=2">
</head>
<body>
<header>
    <div class="header-content">
        <h1>Онлайн-заявления для общежития</h1>
        <nav class="desktop-nav">
            <a href="index.html">Главная</a>
            <a href="application.html" id="parent-app-link">Отправить заявление</a>
            <a href="educator.html" id="educator-app-link" style="display:none;">Пришедшие заявления</a>
            <a href="admin.html" id="admin-panel-link" style="display:none;">Панель администратора</a>
            <a href="about.html">О проекте</a>
            <a href="author.html">Об авторе</a>
        </nav>
        <div class="header-right">
            <div class="status-indicator"></div>
            <button id="logout-btn" style="display:none;">Выход</button>
        </div>
        <button class="burger-menu" id="burger-menu">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

    <div class="sidebar-menu" id="sidebar-menu">
        <button class="close-btn" id="close-btn">
            <i class="fas fa-times"></i>
        </button>
      <nav class="mobile-nav">
    <a href="index.html">Главная</a>
    <a href="application.html">Отправить заявление</a>
    <a href="educator.html" id="educator-link-mobile" style="display:none;">Пришедшие заявления</a>
       <a href="admin.html" id="admin-panel-link-mobile" style="display:none;">Панель администратора</a>
    <a href="about.html">О проекте</a>
    <a href="author.html">Об авторе</a>
</nav>
    </div>

    <div class="container">
        <h2>Вход</h2>
        <p>Войдите, чтобы получить доступ к форме заявления.</p>
        <form id="login-form">
            <label for="iin">ИИН:</label>
            <input type="text" id="iin" name="iin" required>
            <label for="password">Пароль:</label>
            <input type="password" id="password" name="password" required>
            <div id="message" class="alert" style="display:none;"></div>
            <button type="submit">Войти</button>
        </form>
        <p class="mt-3">
            Нет аккаунта? <a href="registration.html">Зарегистрироваться</a>
        </p>
    </div>

 <script src="folder/auth.js?v=2"></script>
     <script>
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('login-form');
        const messageDiv = document.getElementById('message');
if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const iinInput = document.getElementById('iin').value;
        const passwordInput = document.getElementById('password').value;

        try {
            const response = await fetch('https://zayavleniya-site.vercel.app/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    iin: iinInput,
                    password: passwordInput
                })
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userRole', data.role);
                messageDiv.textContent = data.message;
                messageDiv.style.backgroundColor = '#d4edda';
                messageDiv.style.color = '#155724';
                messageDiv.style.display = 'block';

                setTimeout(() => {
                    if (data.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else if (data.role === 'educator') {
                        window.location.href = 'educator.html';
                    } else {
                        window.location.href = 'application.html';
                    }
                }, 1000);
            } else {
                localStorage.setItem('isLoggedIn', 'false');
                messageDiv.textContent = data.message;
                messageDiv.style.color = '#a52a2a';
                messageDiv.style.backgroundColor = '#ffebeb';
                messageDiv.style.display = 'block';
            }
        } catch (error) {
            messageDiv.textContent = 'Ошибка сервера. Попробуйте позже.';
            messageDiv.style.color = '#a52a2a';
            messageDiv.style.backgroundColor = '#ffebeb';
            messageDiv.style.display = 'block';
        }
    });
}
    });
</script>
</body>

</html>
